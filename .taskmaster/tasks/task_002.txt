# Task ID: 2
# Title: Implement and Test Fortran Parser
# Status: done
# Dependencies: 1
# Priority: high
# Description: Implement and test the FortranParser class to parse LAPACK/BLAS source files, extract ASTs, detect routines, and extract call graphs. Handle LAPACK naming conventions and error cases.
# Details:
1. Create a `FortranParser` class that uses the `fortran-src` Haskell tool to parse Fortran source code.
2. Implement methods to extract the AST from the parsed code.
3. Implement routine detection and call graph extraction logic.
4. Add support for parsing LAPACK naming conventions (S/D/C/Z prefixes).
5. Implement error handling for malformed Fortran files.
```python
class FortranParser:
    def __init__(self, filepath):
        self.filepath = filepath

    def parse(self):
        # Use fortran-src to parse the file
        pass

    def extract_ast(self):
        # Extract AST from the parsed code
        pass

    def detect_routines(self):
        # Detect routines in the code
        pass

    def extract_call_graph(self):
        # Extract call graph from the code
        pass
```

# Test Strategy:
Create a suite of unit tests using pytest. Test with various LAPACK/BLAS source files, including those with different prefixes and malformed syntax. Verify that the AST is correctly extracted, routines are detected, and call graphs are accurately generated. Check error handling by providing intentionally malformed files.

# Subtasks:
## 1. Run existing Fortran parser tests [done]
### Dependencies: None
### Description: Execute tests/test_fortran_parser.py to verify current parser functionality
### Details:
<info added on 2025-07-25T16:01:06.239Z>
Tests completed successfully. The existing Fortran parser tests all pass (6/6 tests). The parser correctly handles routine extraction, LAPACK naming conventions, and basic call graph extraction.
</info added on 2025-07-25T16:01:06.239Z>

## 2. Test parser with real LAPACK/BLAS files [done]
### Dependencies: None
### Description: Run the parser on actual LAPACK source files (e.g., BLAS/SRC/dgemm.f) and verify AST extraction
### Details:
<info added on 2025-07-25T16:02:26.244Z>
Successfully tested parser with real LAPACK/BLAS files. Parsed 6 files including dgemm.f, sgemm.f, cgemm.f, zgemm.f (BLAS Level 3), and dgetrf.f, dgetrs.f (LAPACK). All files parsed correctly, extracting routine names, types, and call relationships. The parser correctly identified calls to XERBLA, DGEMM, DTRSM, DLASWP, etc.
</info added on 2025-07-25T16:02:26.244Z>

## 3. Verify LAPACK naming convention parsing [done]
### Dependencies: None
### Description: Test that S/D/C/Z prefixes are correctly parsed and precision/operation extraction works
### Details:
<info added on 2025-07-25T16:03:46.402Z>
Verified LAPACK naming convention parsing works correctly. Tested all 4 precision types: S (single), D (double), C (complex), Z (double complex). The parser correctly extracts precision from first character and operation from remaining characters. Also correctly handles non-LAPACK routines like XERBLA and LSAME by returning None for precision/operation.
</info added on 2025-07-25T16:03:46.402Z>

